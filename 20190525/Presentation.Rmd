---
title: "Marketing Science with R"
author: 'TokyoR #78 Kien Knot(きぬいと; @0_u0)'
date: "2019/5/25"
output:
  ioslides_presentation: 
    widescreen: yes
  beamer_presentation: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
datA <- data.frame(ID = c(1:100),date = c(100:199), Butsu = rep(c(1:5),20))
dat <- datA %>% 
  dplyr::group_by(ID, date) %>% 
  dplyr::summarise(count = n()) %>% 
  tidyr::spread(., key = date, value = count) %>% 
  dplyr::mutate_if(is.numeric, funs(replace(.,is.na(.),0))) %>% 
  dplyr::ungroup()
```

## 自己紹介

- きぬいと([0_u0](https://twitter.com/0_u0))
  - よくLTをやります。
  
- 労働者階級2年目
  - マーケティング系調査屋さんのアナリスト
    - <b>兼</b>部署内作業環境改善係
      - 「きぬいとくんのRコード動かないんだけど」→R ver 3.3.x
    - 開発環境整備中
  
- 最近の出来事  
  - 転職しないことにした
    - キャリアなんもわからん問題でバズってしまった
  - OSをUbuntuに変えた


## 宣伝
- Statistician-jaのDiscordをつくりました
  - 「数理統計学」をやっていくサーバ

- PythonとかRとかではなく「数理統計」のお勉強をやろう
    - `lm(y~., data = dat)`の裏のロジックをつかもう
    - 理論は廃れないのでみんなで理解しよう
- 目標は統計検定1級に合格することなど
- <https://discord.gg/Nq75Smp>にアクセス！
  - Meetupとかも構想中です。
  - 運営の仕方とか教えてほしい

## 今日のお話
- 非IT企業でRで業務を効率化するために<s>殴り合う</s>環境を創るお話
  - 「さーてデータを読み込んだぞー」からのお話

- R: エンジニアじゃない人も割と使ってる
  - でもこの場合エンジニア側からもビジネス側からも浮きがち
  - 主にきぬいとです

- 対象: 会社でR使いたいけどエンジニアじゃないんだよなあという人

## <s>仮想敵</s> 説得したい人
- こんな人たちと<s>殴り合う</s>話し合ってRの良さを知ってもらいたい
  - 定量化できない指標を信仰する人々
  - 母国語がMicr●s●ft office Excelの人々

- R要素は？
  - これがRmarkdownでできているのでTokyoR LTが成立します！！！

## マーケティング・サイエンスとは
- 一昔前に「データドリブン」とか流行った
    - 定量的な評価に基づいて、<b>科学的</b>にマーケティングをやっていこう
- あまり一貫した定義はない（あるある）
- 「データを活用してマーケティングやっていこうよ」だと思ってください
- というか
  
# 「マーケティング」って何？
## 実際に聞いてみた<font size = "5">い</font>
- Q.「マーケティングってなんだと思いますか？」 

 ```{r, eval = TRUE, echo = FALSE}
 x <- c(rep('1.よくわからない',80), rep('2.意識高い',15), rep('3.2020年代最もセクシーな仕事', 5))
 
 plot(as.factor(x))
 ```

## きぬいともよくわかんない

- 「ドリルを買う人は、ドリルがほしいんじゃなくて、穴がほしいんだよ」

<div style="text-align: center;">
  <img src="./.picture/ドリル.jpeg" width="450" height="300">
  </div>
  
- 新人だったころのきぬいと「胡散臭い」

## 「マーケティング」のよくわからなさ
- どうなったら「うまくいった」と言えるのかが<b>よくわからない</b>
  - なにをみたらわかるのか<b>よくわからない</b>

- 指標の測定方法も<b>よくわからない</b>
  - ABテストとか<b>よくわからない</b>

- データの活用方法が<b>よくわからない</b>
  - 大体の企業にはデータはある
    - 「何がわかれば利益につながるのか」<b>よくわからない</b>
    - どんなデータがあると何がわかるのか<b>よくわからない</b>

## 
<div style="text-align: center;"><font size = "40">なんもわからん</font></div>
<div style="text-align: center;">![Thinker](./.picture/erudesusono2.jpg)</div>

## データもよくわからない
- 実際人間の8割はデータも<b>よくわからない</b>
  - [「弊社にはデータが山のようにあるのですが」](https://docs.google.com/presentation/d/192wLLgNzkbwuJ8gLwu_SJMigwxg_EZrYeaK8vBoz3_I/mobilepresent?slide=id.p)
  - 「えくせるで読み込めない規模のデータを使えばAIになると聞きました」

- 非Tech系でのデータ活用はほぼ進んでいない……
  - データはあるのにうまくビジネスに活かせない
  - 当たり前のようにマーケティングサイエンスにも活かせない
  - なぜなのか？

# 取材班は南米の奥地へ飛んだ

# 理由1. KKD信仰

## きいてみました
Q. みなさんが意思決定のときに信じるものはなんですか？
 ```{r, eval = TRUE, echo = FALSE}
 x <- c(rep('1.KKD',80), rep('2.データサイエンス神',15), rep('3.自分', 5))
 
 plot(as.factor(x))
 ```


## KKD（経験・勘・度胸）
- 実際その道のベテランのK・Kは馬鹿にはできない(くやしい)
  - 実際Dなしに決定はできない(それはそう)

- データ分析の価値もKKDに合うかどうかで決まるところもある
  - 「合っているかどうか」を評価する基準が定義できない  
  - 結果「経験」「勘」に頼らざるを得ない
  
- 「K・Kでわかんないことをデータで知って、D以外の行動要因にしたいのに」
  - 「結局データ分析に予算割いても<b>よくわからない</b>のかあ」

## つまり？
- データ分析の結果を評価する基準がどこにもない
  - 明確な指標が社内外問わず定義できてない
  - それを明らかにするにはデータを見るしかない
    - が、データを見る文化がない
  
- 評価指標(見たい数字)から定義するとこっちも楽

# 理由2. Excel信仰

## きいてみました
Q. みなさん「データ分析」で何使ってますか？
 ```{r, eval = TRUE, echo = FALSE}
 x <- c(rep('1.Excel',80), rep('2.心の目',15), rep('3.R', 5))
 
 plot(as.factor(x))
 ```
 
## 「Excelでなんでもできるじゃん」
- <b>「なんでもはできないわよ、できることだけ」</b>
  - Excelでの手計算のミスが業務の8割を占めた2018年度
  - 誰もやりたくてやらかすわけじゃない
- Excelでできないこと=「不可能」
  - 「Excelじゃどうしようもない大規模なデータなんです」
    - <b>20万行</b> × 3列
- Excelで回帰分析やパラメータの調整
  - 実際できる
  - 計算プロセスも見やすいね
- 「もう全部Excelでよくない？」
    
## その結果
- 【紙出用】【きぬいと編集】案件結果_上司確認_ver2_最終盤_A4調整_2019xxxx.xls

<div style="text-align: center;">![こうなる](./.picture/chanmio.jpg)</div>

## 全部Excelでよくない？→よくない！
- バージョン管理が煩雑になる
  - 追加で見たい指標がどんどん増えてサグラダファミリア.xlsx
- 作業工程が属人化する
  - Excelのプロフェッショナリティが人権
- この2つをどうにかしたくない？

# 非Tech系でRを使うということ

## 客の知らないことってなんなのか？
- <b>そもそもデータの見方がわからない</b>
  - 故にKPIもKGIも定義できない
- この辺の整理だけでも割とイケる
  - 分布や単純なクロス集計だけでも発見があることが多い
  - ここで初めてどの指標の評価をするかも判断できる
    
- 予測や分類はこの次のステップ
  - データをちゃんと見せよう
  - <b>魅せる</b>ことすら時期尚早


## 前提: 仕事の8割が記述統計
- `lm`？`glm`？知らない子ですね……
- `table`や`ggplot`で解決する問題が大半
  - 故に「楽にできる」Excelとの戦い
  - どうする……？どうやったらあの大企業のツールに勝てる……？
  
# 報告「Rでやっちゃいました」

## 「事後報告」は最強
- 「お、おう……」で済む。
  - 「勝手なことをするな！」と言われたら……？
    - <b>全く関係ないですけどﾍｲｼｬでは「やるねぇ〜！」と言われます</b>
- コード書いて、Ctrl+Enterで全部自動化
  - Excelの`COUNTIF`とか`VLOOKUP`をtidyに解決
  - 「あとはもうこれを読み込めば解決するんで」
- Excelの表をきれいにするやつは？
  - あ、僕の仕事じゃないんで……

  
## マーケティング・サイエンスのためのR
- 記述統計レベルの問題を明らかにする場合が多い
  - と言いつつそこそこデータ量が多い（データだけはあるので）
- ある業務でのきぬいと
```{r eval = FALSE}
  dat <- datA %>% 
    dplyr::group_by(ID, date) %>% 
    dplyr::summarise(count = n()) %>% 
    tidyr::spread(.,key = date, value = count) %>% 
    dplyr::mutate_if(is.numeric, funs(replace(.,is.na(.),0))) %>% 
    dplyr::ungroup()
```


## 出力
```{r, eval=TRUE}
dat[,1:10] %>% head
```
- 上司が古典文法でガチャガチャやってたやつをモダンに書き換えた
- たった6行で可視化のためのテーブルが完成するのやばない？
  - Excelが得意な人に渡してちゃんと「協力」できる
  - 「R、やるじゃん」となる
  - <b>モテる</b>
  
## つまり？
### 整　然　宇　宙　開　発　局
<div style="text-align: center;">![tidyverse](./.picture/tidyverse.png)</div>

## 冗談抜きで
- `tidyverse`で既存業務をだいぶ改善してきた(はず)
  - 残業時間を大幅に減らしたらストレスが減った
  - 上司が助かっているかはわからない……助かっていると信じたい
  - 宇宙による開発だけで月100万位稼いでいる(はず)
- でかいExcelファイルを開くのに待つ必要性がだいぶ減った
- `ggplot2`やら`DiagrammeR`やらでの可視化で表を見やすくできる
  - いいぞ

## お客様の声
- 「この動きは知らなかったなあ」
- 「ライバルと比べるとこうなっているのか」
- 「ここからこういうことできますか？」
  - Rのおかげで受ける仕事の質も上がりました！

## 結論
- Marketing Scienceは記述統計から入ろう
  - 回帰分析とか誰も知らない
  - よくあるご質問
    - 「切片は誤差とは違うんですか？」
    - 「回帰係数は1を越えるんですか！？」い
- Statisticの語源に忠実にいこう
  - state/status「状態」の記述
  - <s>マーケティングで推定とかそんなの魔法っすよ。</s>
  - 予測モデルで金をとる前に金を取れる環境をつくろうな(ゲス顔)

## 今後
- 研修とかのためにこれまでのTipsをドキュメント化する
  - Rmdでいけんじゃね？
    - たまにPython使うけど
    - PythonもRmdでまとめられるんじゃね？

- R開発環境の統一
  - バージョン管理がめんどい
    - 未だに社員のローカル環境依存
    - こんな課題を解決したい（エンジニア発想）
  - Docker使えばなんとかなんじゃね？
  - 鋭意開発中
    - この辺知ってて一緒に働きたい人も募集中

## Enjoy!!
- Rmdでの資料作成及び公開方法にあたり、[y__mattu](https://twitter.com/y__mattu)氏と[atusy](https://twitter.com/Atsushi776)氏より多大なるご支援を頂きました。